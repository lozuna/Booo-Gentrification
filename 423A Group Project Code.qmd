---
title: "School Climate and Student Growth"
author: "Michael O'key, Michael Chrzan, Laisha Ozuna"
date: "`r Sys.Date()`"
format: html
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Honor Code Statement

We strongly encourage students to form study groups and students may discuss and work on assignments in groups. We expect that each student understands their own submission. As such, students must write their submissions independently and clearly disclose the names of all other students who were part of their study group. Additionally, lifting code or solutions directly from the internet (e.g., Google, GitHub, Stack Overflow) is a violation of the [Stanford Honor Code](https://communitystandards.stanford.edu/policies-and-guidance/honor-code). We take academic honesty and Honor Code violations extremely seriously and expect the same of students. If you have questions about what may or may not constitute an Honor Code violation, please reach out the teaching team.

**Email: michael.okey\@stanford.edu, mlchrzan\@stanford.edu, lozuna\@stanford.edu**

**SUID: ???, 05745732, ???**

**Study Group: The authors**

I acknowledge and agree to abide by the Honor Code.

**Signed: Michael O'key, Michael Leon Chrzan, Laisha Ozuna**

## Running Code

Research Question \| What relationship, if any, exists between gentrification, as operationalized by the Pearman and Greene (2022) model, and educational outcomes in San Francisco and Detroit between 2010 and 2020?

```{r libraries, include=FALSE}
library(tidyverse)
library(tidytext)
library(stringr)
library(readxl)
library(curl)
library(janitor)
library(RColorBrewer)
library(viridis)
library(skimr)
library(cowplot)
library(here)
```

# Import Data

```{r housing-data, echo=FALSE, include=FALSE}
det2020 <- read_csv("Detroit Housing Data/Detroit housing Data 2020.csv") |> clean_names()
det2019 <- read_csv("Detroit Housing Data/Detroit housing Data 2019.csv") |> clean_names()
det2018 <- read_csv("Detroit Housing Data/Detroit housing Data 2018.csv") |> clean_names()
det2017 <- read_csv("Detroit Housing Data/Detroit housing Data 2017.csv") |> clean_names()
det2016 <- read_csv("Detroit Housing Data/Detroit housing Data 2016.csv") |> clean_names()
det2015 <- read_csv("Detroit Housing Data/Detroit housing Data 2015.csv") |> clean_names()
det2014 <- read_csv("Detroit Housing Data/Detroit housing Data 2014.csv") |> clean_names()
det2013 <- read_csv("Detroit Housing Data/Detroit housing Data 2013.csv") |> clean_names()
det2012 <- read_csv("Detroit Housing Data/Detroit housing Data 2012.csv") |> clean_names()
det2011 <- read_csv("Detroit Housing Data/Detroit housing Data 2011.csv") |> clean_names()
det2010 <- read_csv("Detroit Housing Data/Detroit housing Data 2010.csv") |> clean_names()

```

```{r acs-ed-data, echo=FALSE, include=FALSE}

acs_detroit_2010 <- read_csv('ACS Detroit Education Data/ACSDtrt2010-Data.csv') 
acs_detroit_2011 <- read_csv('ACS Detroit Education Data/ACSDtrt2011-Data.csv') 
acs_detroit_2012 <- read_csv('ACS Detroit Education Data/ACSDtrt2012-Data.csv') 
acs_detroit_2013 <- read_csv('ACS Detroit Education Data/ACSDtrt2013-Data.csv') 
acs_detroit_2014 <- read_csv('ACS Detroit Education Data/ACSDtrt2014-Data.csv') 
acs_detroit_2015 <- read_csv('ACS Detroit Education Data/ACSDtrt2015-Data.csv') 
acs_detroit_2016 <- read_csv('ACS Detroit Education Data/ACSDtrt2016-Data.csv') 
acs_detroit_2017 <- read_csv('ACS Detroit Education Data/ACSDtrt2017-Data.csv') 
acs_detroit_2018 <- read_csv('ACS Detroit Education Data/ACSDtrt2018-Data.csv') 
acs_detroit_2019 <- read_csv('ACS Detroit Education Data/ACSDtrt2019-Data.csv')
acs_detroit_2020 <- read_csv('ACS Detroit Education Data/ACSDtrt2020-Data.csv')


```

# Detroit Housing Data Cleaning and Analysis

```{r clean-housing}
# List of years
years <- 2010:2020

# Loop over each year
for(year in years) {
  # Construct the tibble name
  tibble_name <- paste0("det", year)
  
  # Evaluate the tibble name to get the actual tibble
  tibble <- eval(parse(text = tibble_name))
  
  # Perform the operations
  tibble <- tibble |> 
    select(-starts_with("units_in_structure"),
           -starts_with("rooms"),
           -starts_with("bedrooms"),
           -starts_with("housing_tenure"),
           -starts_with("vehicles_available"),
           -starts_with("house_heating"),
           -starts_with("selected_characteristics"),
           -starts_with("occupants_per_room"), 
           -starts_with("year_householder"),
           -starts_with("selected_monthly_owner_costs"),
           -starts_with("mortgage_status"),
           -starts_with("year_structure_built"),
           -contains("grapi"),
           -housing_occupancy, 
           -value, 
           -mortgage_status,
           -selected_monthly_owner_costs_smoc,
           -gross_rent, 
           -selected_monthly_owner_costs_as_a_percentage_of_household_income_smocapi, 
           -selected_monthly_owner_costs_smoc,
           -gross_rent_as_a_percentage_of_household_income_grapi) |> 
    mutate(year = year)
  
  tibble <- tibble |> 
    mutate(label_grouping = str_trim(label_grouping)) |> 
    filter(label_grouping == 'Estimate') |> 
    select(-label_grouping)
  
  #Assign the modified tibble back to the original tibble
  assign(tibble_name, tibble, envir = .GlobalEnv)
}

det_data <- bind_rows(det2010, det2011, det2012,det2013, det2014, det2015, det2016, det2017, det2018, det2019, det2020) |> 
  select(year, everything())

det_data <- det_data |>
  unite('occupied_housing_units', contains('occupied_housing_units'), na.rm = TRUE) |> 
  unite('vacant_housing_units', contains('vacant_housing_units'), na.rm = TRUE) |> 
  unite('homeowner_vacancy_rate', contains('homeowner_vacancy_rate'), na.rm = TRUE)  |> 
  unite('rental_vacancy_rate', contains('rental_vacancy_rate'), na.rm = TRUE)  |> 
  unite("value_less_than_50_000", contains("less_than_50_000"), na.rm = TRUE) |> 
  unite("value_50_000_to_99_999", contains("50_000_to_99_999"), na.rm = TRUE) |> 
  unite('value_100_000_to_149_999', contains('100_000_to_149_999'), na.rm = TRUE) |> 
  unite('value_150_000_to_199_999', contains('150_000_to_199_999'), na.rm = TRUE) |> 
  unite('value_200_000_to_299_999', contains('200_000_to_299_999'), na.rm = TRUE) |> 
  unite('value_300_000_to_499_999', contains('300_000_to_499_999'), na.rm = TRUE) |> 
  unite('value_500_000_to_999_999', contains('500_000_to_999_999'), na.rm = TRUE) |> 
  unite('value_1_000_000_or_more', contains('1_000_000_or_more'), na.rm = TRUE) |> 
  unite('value_median_dollars', value_median_dollars, value_owner_occupied_units_median_dollars, na.rm = TRUE) |> 
  unite('gross_rent_median_dollars', gross_rent_median_dollars, gross_rent_occupied_units_paying_rent_median_dollars, na.rm = TRUE) |> 
  unite('gross_rent_no_rent_paid', contains('no_rent_paid'), na.rm = TRUE) |> 
  unite('gross_rent_1_500_or_more', gross_rent_1_500_or_more, gross_rent_occupied_units_paying_rent_1_500_or_more, na.rm = TRUE) |> 
  unite("gross_rent_less_than_200", contains('rent_less_than_200'), na.rm = TRUE) |>
  unite("gross_rent_200_to_299", contains('rent_200_to_299'), na.rm = TRUE) |> 
  unite("gross_rent_300_to_499", contains('rent_300_to_499'), na.rm = TRUE) |> 
  unite("gross_rent_500_to_749", contains('rent_500_to_749'), na.rm = TRUE) |> 
  unite("gross_rent_750_to_999", contains('rent_750_to_999'), na.rm = TRUE) |> 
  unite("gross_rent_1_000_to_1_499", contains('1_000_to_1_499'), na.rm = TRUE)
  

det_data <- det_data |>  
  mutate(across(where(is.character), ~str_replace_all(., ',', ''))) |> 
  mutate_all(as.numeric) |> 
  mutate(structures_built = case_when(
    year == 2014 ~ 6, 
    year == 2015 ~ 45, 
    year == 2016 ~ 173, 
    year == 2017 ~ 202, 
    year == 2018 ~ 467, 
    year == 2019 ~ 1115, 
    year == 2020 ~ 99))


det_data <- det_data |> 
  mutate(gross_rent_less_than_500 = gross_rent_less_than_200+gross_rent_200_to_299+gross_rent_300_to_499, 
         gross_rent_500_to_999 = gross_rent_500_to_749 + gross_rent_750_to_999, 
         gross_rent_1_500_or_more_occupied = gross_rent_occupied_units_paying_rent_1_500_to_1_999+gross_rent_occupied_units_paying_rent_2_000_to_2_499+gross_rent_occupied_units_paying_rent_2_500_to_2_999+gross_rent_occupied_units_paying_rent_3_000_or_more, 
         .keep = "unused")

det_data <- det_data |> 
  unite("gross_rent_less_than_500", contains('rent_less_than_500'), na.rm = TRUE) |> 
  unite("gross_rent_500_to_999", contains('rent_500_to_999'), na.rm = TRUE) |> 
  unite("gross_rent_1_500_or_more", contains('1_500_or_more'), na.rm = TRUE) 

det_data <- det_data |> 
  select(year, structures_built, contains('median'), starts_with('value'), gross_rent_less_than_500, gross_rent_500_to_999, gross_rent_1_000_to_1_499, gross_rent_1_500_or_more, starts_with('gross'), everything())
```

```{r viz-housing-rent}
det_data |> 
  ggplot() + 
  geom_line(aes(x = year, 
                y = value_median_dollars)) + 
  geom_point(data = filter(det_data, year < 2014), 
             aes(x = year, 
                 y = value_median_dollars)) +
  geom_point(aes(x = year, 
                 y = value_median_dollars,
                 color = 'red',
                 size = structures_built)) +
  
  labs(title = "Is Detroit Gentrifying?", 
       subtitle = 'Median Detroit Property Value, 2010-2020', 
       x = 'Year',
       y = 'Median Property Value') + 
  scale_size(name = "Number of Structures Built") +
  theme_minimal() + 
  guides(color = 'none') +
  theme(legend.position = 'bottom')  
  
  

det_data |> 
  ggplot() + 
  geom_line(aes(x = year, 
                y = gross_rent_median_dollars)) + 
  geom_point(data = filter(det_data, year < 2014),
             aes(x = year, 
                 y = gross_rent_median_dollars)) +
  geom_point(aes(x = year, 
                 y = gross_rent_median_dollars,
                 color = 'red',
                 size = structures_built)) +
  
  labs(title = "Is Detroit Gentrifying?", 
       subtitle = 'Median Detroit Rent Costs, 2010-2020', 
       x = 'Year',
       y = 'Median Rent Cost') + 
  scale_size(name = "Number of Structures Built") +
  guides(color = 'none') +
  theme_minimal() +
  theme(legend.position = 'bottom')
```

```{r viz-housing-value}
det_data |> 
  pivot_longer(cols = c(value_less_than_50_000, value_50_000_to_99_999, value_100_000_to_149_999, value_150_000_to_199_999, value_200_000_to_299_999, value_300_000_to_499_999, value_500_000_to_999_999, value_1_000_000_or_more),
               names_to = 'value_category', 
               values_to = 'number_of_properties') |> 
  select(year, value_median_dollars, value_category, number_of_properties) |> 
  mutate(year = as.character(year), 
         value_category = case_when(
           value_category == 'value_less_than_50_000' ~ 'Less than $50k',
           value_category == 'value_50_000_to_99_999' ~ '$50k - $99k', 
           value_category == 'value_100_000_to_149_999' ~ '$100k - $149k', 
           value_category == 'value_150_000_to_199_999' ~ '$150k - $199k', 
           value_category == 'value_200_000_to_299_999' ~ '$200k - $299k',
           value_category == 'value_300_000_to_499_999' ~ '$300k - $499k', 
           value_category == 'value_500_000_to_999_999' ~ '$500k - $999k', 
           value_category == 'value_1_000_000_or_more' ~ '$1000000+')) |> 
  
  ggplot() + 
  geom_col(aes(x = factor(value_category, 
                          levels = c('Less than $50k',
                                     '$50k - $99k', 
                                     '$100k - $149k', 
                                     '$150k - $199k', 
                                     '$200k - $299k',
                                     '$300k - $499k', 
                                     '$500k - $999k', 
                                     '$1000000+'), 
                          ordered = TRUE),
               y = number_of_properties, 
               fill = year), 
           position = 'dodge') + 
  labs(title = "Detroit's Housing Values are Increasing",
       subtitle = "Detroit Housing Values, 2010-2020", 
       x = 'Housing Value', 
       y = 'Number of Properties') + 
  coord_flip() +
  scale_fill_viridis(discrete = TRUE) +
  theme_minimal()
```

# ACS Detroit Education Data Cleaning and Analysis

```{r clean-columns}
colnames(acs_detroit_2010) <- acs_detroit_2010[1, ]
acs_detroit_2010 <- acs_detroit_2010[-1, ]

colnames(acs_detroit_2011) <- acs_detroit_2011[1, ]
acs_detroit_2011 <- acs_detroit_2011[-1, ]

colnames(acs_detroit_2012) <- acs_detroit_2012[1, ]
acs_detroit_2012 <- acs_detroit_2012[-1, ]

colnames(acs_detroit_2013) <- acs_detroit_2013[1, ]
acs_detroit_2013 <- acs_detroit_2013[-1, ]

colnames(acs_detroit_2014) <- acs_detroit_2014[1, ]
acs_detroit_2014 <- acs_detroit_2014[-1, ]

colnames(acs_detroit_2015) <- acs_detroit_2015[1, ]
acs_detroit_2015 <- acs_detroit_2015[-1, ]

colnames(acs_detroit_2016) <- acs_detroit_2016[1, ]
acs_detroit_2016 <- acs_detroit_2016[-1, ]

colnames(acs_detroit_2017) <- acs_detroit_2017[1, ]
acs_detroit_2017 <- acs_detroit_2017[-1, ]

colnames(acs_detroit_2018) <- acs_detroit_2018[1, ]
acs_detroit_2018 <- acs_detroit_2018[-1, ]

colnames(acs_detroit_2019) <- acs_detroit_2019[1, ]
acs_detroit_2019 <- acs_detroit_2019[-1, ]

colnames(acs_detroit_2020) <- acs_detroit_2020[1, ]
acs_detroit_2020 <- acs_detroit_2020[-1, ]
```

```{r clean-variables}
#parse for educational attainment data
educ_detroit_2010 <- acs_detroit_2010 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
  clean_names()

educ_detroit_2011 <- acs_detroit_2011 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
  clean_names()

educ_detroit_2012 <- acs_detroit_2012 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
  clean_names()

educ_detroit_2013 <- acs_detroit_2013 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
  clean_names()

educ_detroit_2014 <- acs_detroit_2014 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
   clean_names()

educ_detroit_2015 <- acs_detroit_2015 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
   clean_names()

educ_detroit_2016 <- acs_detroit_2016 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
   clean_names()

educ_detroit_2017 <- acs_detroit_2017 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
   clean_names()

educ_detroit_2018 <- acs_detroit_2018 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
  clean_names()

educ_detroit_2019 <- acs_detroit_2019 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
   clean_names()

educ_detroit_2020 <- acs_detroit_2020 |>
  select(1:2, starts_with("Estimate!!EDUCATIONAL ATTAINMENT!!"), 
         starts_with("Percent!!EDUCATIONAL ATTAINMENT!!")) |>
   clean_names()

```

```{r convert-to-numeric}
convert_to_dbl <- function(x) {
  ifelse(str_detect(x, "^\\d+\\.?\\d*$"), as.numeric(x), x)
}

# apply <dbl> to select columns and add year
educ_detroit_2010 <- educ_detroit_2010 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2010) |>
  select(-estimate_educational_attainment_percent_high_school_graduate_or_higher, -estimate_educational_attainment_percent_bachelors_degree_or_higher)

educ_detroit_2011 <- educ_detroit_2011 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2011) |>
  select(-estimate_educational_attainment_percent_high_school_graduate_or_higher, -estimate_educational_attainment_percent_bachelors_degree_or_higher)

educ_detroit_2012 <- educ_detroit_2012 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2012) |>
  select(-estimate_educational_attainment_percent_high_school_graduate_or_higher, -estimate_educational_attainment_percent_bachelors_degree_or_higher)

educ_detroit_2013 <- educ_detroit_2013 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2013) |>
  rename(estimate_educational_attainment_less_than_9th_grade =
           "estimate_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         estimate_educational_attainment_9th_to_12th_grade_no_diploma = "estimate_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         estimate_educational_attainment_high_school_graduate_includes_equivalency = "estimate_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         estimate_educational_attainment_some_college_no_degree = "estimate_educational_attainment_population_25_years_and_over_some_college_no_degree",
         estimate_educational_attainment_associates_degree = "estimate_educational_attainment_population_25_years_and_over_associates_degree",
         estimate_educational_attainment_bachelors_degree = "estimate_educational_attainment_population_25_years_and_over_bachelors_degree",
         estimate_educational_attainment_graduate_or_professional_degree = "estimate_educational_attainment_population_25_years_and_over_graduate_or_professional_degree",
         percent_educational_attainment_less_than_9th_grade = "percent_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         percent_educational_attainment_9th_to_12th_grade_no_diploma = "percent_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         percent_educational_attainment_high_school_graduate_includes_equivalency = "percent_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         percent_educational_attainment_some_college_no_degree = "percent_educational_attainment_population_25_years_and_over_some_college_no_degree",
         percent_educational_attainment_associates_degree = "percent_educational_attainment_population_25_years_and_over_associates_degree",
         percent_educational_attainment_bachelors_degree = "percent_educational_attainment_population_25_years_and_over_bachelors_degree",
         percent_educational_attainment_graduate_or_professional_degree = "percent_educational_attainment_population_25_years_and_over_graduate_or_professional_degree") |>
  select(-estimate_educational_attainment_percent_high_school_graduate_or_higher, -estimate_educational_attainment_percent_bachelors_degree_or_higher)

educ_detroit_2014 <- educ_detroit_2014 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2014) |>
  rename(estimate_educational_attainment_less_than_9th_grade =
           "estimate_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         estimate_educational_attainment_9th_to_12th_grade_no_diploma = "estimate_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         estimate_educational_attainment_high_school_graduate_includes_equivalency = "estimate_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         estimate_educational_attainment_some_college_no_degree = "estimate_educational_attainment_population_25_years_and_over_some_college_no_degree",
         estimate_educational_attainment_associates_degree = "estimate_educational_attainment_population_25_years_and_over_associates_degree",
         estimate_educational_attainment_bachelors_degree = "estimate_educational_attainment_population_25_years_and_over_bachelors_degree",
         estimate_educational_attainment_graduate_or_professional_degree = "estimate_educational_attainment_population_25_years_and_over_graduate_or_professional_degree",
         percent_educational_attainment_less_than_9th_grade = "percent_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         percent_educational_attainment_9th_to_12th_grade_no_diploma = "percent_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         percent_educational_attainment_high_school_graduate_includes_equivalency = "percent_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         percent_educational_attainment_some_college_no_degree = "percent_educational_attainment_population_25_years_and_over_some_college_no_degree",
         percent_educational_attainment_associates_degree = "percent_educational_attainment_population_25_years_and_over_associates_degree",
         percent_educational_attainment_bachelors_degree = "percent_educational_attainment_population_25_years_and_over_bachelors_degree",
         percent_educational_attainment_graduate_or_professional_degree = "percent_educational_attainment_population_25_years_and_over_graduate_or_professional_degree") |>
  select(-estimate_educational_attainment_percent_high_school_graduate_or_higher, -estimate_educational_attainment_percent_bachelors_degree_or_higher)

educ_detroit_2015 <- educ_detroit_2015 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2015) |>
  rename(estimate_educational_attainment_less_than_9th_grade =
           "estimate_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         estimate_educational_attainment_9th_to_12th_grade_no_diploma = "estimate_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         estimate_educational_attainment_high_school_graduate_includes_equivalency = "estimate_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         estimate_educational_attainment_some_college_no_degree = "estimate_educational_attainment_population_25_years_and_over_some_college_no_degree",
         estimate_educational_attainment_associates_degree = "estimate_educational_attainment_population_25_years_and_over_associates_degree",
         estimate_educational_attainment_bachelors_degree = "estimate_educational_attainment_population_25_years_and_over_bachelors_degree",
         estimate_educational_attainment_graduate_or_professional_degree = "estimate_educational_attainment_population_25_years_and_over_graduate_or_professional_degree",
         percent_educational_attainment_less_than_9th_grade = "percent_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         percent_educational_attainment_9th_to_12th_grade_no_diploma = "percent_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         percent_educational_attainment_high_school_graduate_includes_equivalency = "percent_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         percent_educational_attainment_some_college_no_degree = "percent_educational_attainment_population_25_years_and_over_some_college_no_degree",
         percent_educational_attainment_associates_degree = "percent_educational_attainment_population_25_years_and_over_associates_degree",
         percent_educational_attainment_bachelors_degree = "percent_educational_attainment_population_25_years_and_over_bachelors_degree",
         percent_educational_attainment_graduate_or_professional_degree = "percent_educational_attainment_population_25_years_and_over_graduate_or_professional_degree") |>
  select(-estimate_educational_attainment_percent_high_school_graduate_or_higher, -estimate_educational_attainment_percent_bachelors_degree_or_higher)

educ_detroit_2016 <- educ_detroit_2016 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2016) |>
  rename(estimate_educational_attainment_less_than_9th_grade =
           "estimate_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         estimate_educational_attainment_9th_to_12th_grade_no_diploma = "estimate_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         estimate_educational_attainment_high_school_graduate_includes_equivalency = "estimate_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         estimate_educational_attainment_some_college_no_degree = "estimate_educational_attainment_population_25_years_and_over_some_college_no_degree",
         estimate_educational_attainment_associates_degree = "estimate_educational_attainment_population_25_years_and_over_associates_degree",
         estimate_educational_attainment_bachelors_degree = "estimate_educational_attainment_population_25_years_and_over_bachelors_degree",
         estimate_educational_attainment_graduate_or_professional_degree = "estimate_educational_attainment_population_25_years_and_over_graduate_or_professional_degree",
         percent_educational_attainment_less_than_9th_grade = "percent_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         percent_educational_attainment_9th_to_12th_grade_no_diploma = "percent_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         percent_educational_attainment_high_school_graduate_includes_equivalency = "percent_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         percent_educational_attainment_some_college_no_degree = "percent_educational_attainment_population_25_years_and_over_some_college_no_degree",
         percent_educational_attainment_associates_degree = "percent_educational_attainment_population_25_years_and_over_associates_degree",
         percent_educational_attainment_bachelors_degree = "percent_educational_attainment_population_25_years_and_over_bachelors_degree",
         percent_educational_attainment_graduate_or_professional_degree = "percent_educational_attainment_population_25_years_and_over_graduate_or_professional_degree") |>
  select(-estimate_educational_attainment_percent_high_school_graduate_or_higher, -estimate_educational_attainment_percent_bachelors_degree_or_higher)

#Converstion Continued (blocks combined into one)
educ_detroit_2017 <- educ_detroit_2017 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2017) |>
  rename(estimate_educational_attainment_less_than_9th_grade =
           "estimate_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         estimate_educational_attainment_9th_to_12th_grade_no_diploma = "estimate_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         estimate_educational_attainment_high_school_graduate_includes_equivalency = "estimate_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         estimate_educational_attainment_some_college_no_degree = "estimate_educational_attainment_population_25_years_and_over_some_college_no_degree",
         estimate_educational_attainment_associates_degree = "estimate_educational_attainment_population_25_years_and_over_associates_degree",
         estimate_educational_attainment_bachelors_degree = "estimate_educational_attainment_population_25_years_and_over_bachelors_degree",
         estimate_educational_attainment_graduate_or_professional_degree = "estimate_educational_attainment_population_25_years_and_over_graduate_or_professional_degree",
         percent_educational_attainment_less_than_9th_grade = "percent_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         percent_educational_attainment_9th_to_12th_grade_no_diploma = "percent_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         percent_educational_attainment_high_school_graduate_includes_equivalency = "percent_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         percent_educational_attainment_some_college_no_degree = "percent_educational_attainment_population_25_years_and_over_some_college_no_degree",
         percent_educational_attainment_associates_degree = "percent_educational_attainment_population_25_years_and_over_associates_degree",
         percent_educational_attainment_bachelors_degree = "percent_educational_attainment_population_25_years_and_over_bachelors_degree",
         percent_educational_attainment_graduate_or_professional_degree = "percent_educational_attainment_population_25_years_and_over_graduate_or_professional_degree") |>
  select(-estimate_educational_attainment_percent_high_school_graduate_or_higher, -estimate_educational_attainment_percent_bachelors_degree_or_higher)

educ_detroit_2018 <- educ_detroit_2018 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2018) |>
  rename(estimate_educational_attainment_less_than_9th_grade =
           "estimate_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         estimate_educational_attainment_9th_to_12th_grade_no_diploma = "estimate_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         estimate_educational_attainment_high_school_graduate_includes_equivalency = "estimate_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         estimate_educational_attainment_some_college_no_degree = "estimate_educational_attainment_population_25_years_and_over_some_college_no_degree",
         estimate_educational_attainment_associates_degree = "estimate_educational_attainment_population_25_years_and_over_associates_degree",
         estimate_educational_attainment_bachelors_degree = "estimate_educational_attainment_population_25_years_and_over_bachelors_degree",
         estimate_educational_attainment_graduate_or_professional_degree = "estimate_educational_attainment_population_25_years_and_over_graduate_or_professional_degree") |>                            #add percentages
  mutate(percent_educational_attainment_population_25_years_and_over = estimate_educational_attainment_population_25_years_and_over,
         percent_educational_attainment_less_than_9th_grade = round((estimate_educational_attainment_less_than_9th_grade / estimate_educational_attainment_population_25_years_and_over) * 100, 1),
         percent_educational_attainment_9th_to_12th_grade_no_diploma = round((estimate_educational_attainment_9th_to_12th_grade_no_diploma / estimate_educational_attainment_population_25_years_and_over) * 100, 1),
         percent_educational_attainment_high_school_graduate_includes_equivalency = round((estimate_educational_attainment_high_school_graduate_includes_equivalency / estimate_educational_attainment_population_25_years_and_over) * 100, 1),
         percent_educational_attainment_some_college_no_degree = round((estimate_educational_attainment_some_college_no_degree / estimate_educational_attainment_population_25_years_and_over) * 100, 1),
         percent_educational_attainment_associates_degree = round((estimate_educational_attainment_associates_degree / estimate_educational_attainment_population_25_years_and_over) * 100, 1),
         percent_educational_attainment_bachelors_degree = round((estimate_educational_attainment_bachelors_degree / estimate_educational_attainment_population_25_years_and_over) * 100, 1),
         percent_educational_attainment_graduate_or_professional_degree = round((estimate_educational_attainment_graduate_or_professional_degree / estimate_educational_attainment_population_25_years_and_over) * 100, 1),
         percent_educational_attainment_percent_high_school_graduate_or_higher = round((estimate_educational_attainment_population_25_years_and_over_high_school_graduate_or_higher / estimate_educational_attainment_population_25_years_and_over) * 100, 1),
         percent_educational_attainment_percent_bachelors_degree_or_higher = round((estimate_educational_attainment_population_25_years_and_over_bachelors_degree_or_higher / estimate_educational_attainment_population_25_years_and_over) * 100, 1)) |>
  select(-estimate_educational_attainment_population_25_years_and_over_high_school_graduate_or_higher, -estimate_educational_attainment_population_25_years_and_over_bachelors_degree_or_higher)
  
educ_detroit_2019 <- educ_detroit_2019 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2019) |>
  rename(estimate_educational_attainment_less_than_9th_grade =
           "estimate_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         estimate_educational_attainment_9th_to_12th_grade_no_diploma = "estimate_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         estimate_educational_attainment_high_school_graduate_includes_equivalency = "estimate_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         estimate_educational_attainment_some_college_no_degree = "estimate_educational_attainment_population_25_years_and_over_some_college_no_degree",
         estimate_educational_attainment_associates_degree = "estimate_educational_attainment_population_25_years_and_over_associates_degree",
         estimate_educational_attainment_bachelors_degree = "estimate_educational_attainment_population_25_years_and_over_bachelors_degree",
         estimate_educational_attainment_graduate_or_professional_degree = "estimate_educational_attainment_population_25_years_and_over_graduate_or_professional_degree",
         percent_educational_attainment_less_than_9th_grade = "percent_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         percent_educational_attainment_9th_to_12th_grade_no_diploma = "percent_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         percent_educational_attainment_high_school_graduate_includes_equivalency = "percent_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         percent_educational_attainment_some_college_no_degree = "percent_educational_attainment_population_25_years_and_over_some_college_no_degree",
         percent_educational_attainment_associates_degree = "percent_educational_attainment_population_25_years_and_over_associates_degree",
         percent_educational_attainment_bachelors_degree = "percent_educational_attainment_population_25_years_and_over_bachelors_degree",
         percent_educational_attainment_graduate_or_professional_degree = "percent_educational_attainment_population_25_years_and_over_graduate_or_professional_degree",
         percent_educational_attainment_percent_high_school_graduate_or_higher = "percent_educational_attainment_population_25_years_and_over_high_school_graduate_or_higher",
         percent_educational_attainment_percent_bachelors_degree_or_higher = "percent_educational_attainment_population_25_years_and_over_bachelors_degree_or_higher"  
         ) |>
  select(-estimate_educational_attainment_population_25_years_and_over_high_school_graduate_or_higher, -estimate_educational_attainment_population_25_years_and_over_bachelors_degree_or_higher)

educ_detroit_2020 <- educ_detroit_2020 |>
  mutate_all(convert_to_dbl) |>
  mutate(year = 2020) |>
  rename(estimate_educational_attainment_less_than_9th_grade =
           "estimate_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         estimate_educational_attainment_9th_to_12th_grade_no_diploma = "estimate_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         estimate_educational_attainment_high_school_graduate_includes_equivalency = "estimate_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         estimate_educational_attainment_some_college_no_degree = "estimate_educational_attainment_population_25_years_and_over_some_college_no_degree",
         estimate_educational_attainment_associates_degree = "estimate_educational_attainment_population_25_years_and_over_associates_degree",
         estimate_educational_attainment_bachelors_degree = "estimate_educational_attainment_population_25_years_and_over_bachelors_degree",
         estimate_educational_attainment_graduate_or_professional_degree = "estimate_educational_attainment_population_25_years_and_over_graduate_or_professional_degree",
         percent_educational_attainment_less_than_9th_grade = "percent_educational_attainment_population_25_years_and_over_less_than_9th_grade",
         percent_educational_attainment_9th_to_12th_grade_no_diploma = "percent_educational_attainment_population_25_years_and_over_9th_to_12th_grade_no_diploma",
         percent_educational_attainment_high_school_graduate_includes_equivalency = "percent_educational_attainment_population_25_years_and_over_high_school_graduate_includes_equivalency",
         percent_educational_attainment_some_college_no_degree = "percent_educational_attainment_population_25_years_and_over_some_college_no_degree",
         percent_educational_attainment_associates_degree = "percent_educational_attainment_population_25_years_and_over_associates_degree",
         percent_educational_attainment_bachelors_degree = "percent_educational_attainment_population_25_years_and_over_bachelors_degree",
         percent_educational_attainment_graduate_or_professional_degree = "percent_educational_attainment_population_25_years_and_over_graduate_or_professional_degree",
         percent_educational_attainment_percent_high_school_graduate_or_higher = "percent_educational_attainment_population_25_years_and_over_high_school_graduate_or_higher",
         percent_educational_attainment_percent_bachelors_degree_or_higher = "percent_educational_attainment_population_25_years_and_over_bachelors_degree_or_higher"  
         ) |>
  select(-estimate_educational_attainment_population_25_years_and_over_high_school_graduate_or_higher, -estimate_educational_attainment_population_25_years_and_over_bachelors_degree_or_higher)
```

```{r bind-ed-acs-data}
educ_detroit <- bind_rows(educ_detroit_2010,
                          educ_detroit_2011,
                          educ_detroit_2012,
                          educ_detroit_2013,
                          educ_detroit_2014,
                          educ_detroit_2015,
                          educ_detroit_2016,
                          educ_detroit_2017,
                          educ_detroit_2018,
                          educ_detroit_2019,
                          educ_detroit_2020)
```

```{r viz-acs-ed-1}
ggplot(educ_detroit, aes(x = factor(year), group = 1)) +
  geom_line(aes(y = percent_educational_attainment_9th_to_12th_grade_no_diploma, 
                color = "No High School Diploma"), linewidth = 1) +
  geom_line(aes(y = percent_educational_attainment_high_school_graduate_includes_equivalency,
                color = "GED"), linewidth = 1) +
  geom_line(aes(y = percent_educational_attainment_some_college_no_degree, 
                color = "Some college"), linewidth = 1) +
  geom_line(aes(y = percent_educational_attainment_associates_degree, 
                color = "Associate's Degree"), linewidth = 1) +
  geom_line(aes(y = percent_educational_attainment_bachelors_degree, 
                color = "Bachelor's Degree"), linewidth = 1) +
  geom_line(aes(y = percent_educational_attainment_graduate_or_professional_degree, 
                color = "PhD"), linewidth = 1) +
  labs(title = "Population and Education Trends in Detroit, MI",
       x = "\nYear",
       y = "% of Population\n",
       color = "") +
  scale_color_manual(values = c("No High School Diploma" = "blue",
                                "GED" = "purple",
                                "Some college" = "pink",
                                "Associate's Degree" = "gray",
                                "Bachelor's Degree" = "green", 
                                "PhD" = "red"),
                     breaks = c("No High School Diploma",
                                "GED",
                                "Some college",
                                "Associate's Degree",
                                "Bachelor's Degree",
                                "PhD")) +
  geom_vline(xintercept = c("2019"), linetype = "dashed", color = "gray", linewidth = 1) +
  theme_minimal() +
  scale_x_discrete(labels = educ_detroit$year) +
  theme(axis.text.x = element_text(hjust = 0.8, angle = 45, vjust=0.5)) 
```

```{r viz-acs-ed-2}
educ_detroit |>
  select(year, 
         percent_bachelors_or_higher = percent_educational_attainment_percent_bachelors_degree_or_higher,
         percent_high_school_or_higher = percent_educational_attainment_percent_high_school_graduate_or_higher) |>
  pivot_longer(cols = -year, 
               names_to = "educational_attainment",
               values_to = "percentage") |>
  mutate(educational_attainment = gsub("percent_", "", educational_attainment),
         educational_attainment = factor(educational_attainment, 
                                         levels = c("high_school_or_higher", "bachelors_or_higher"))) |>
  ggplot(aes(x = year, y = percentage, fill = educational_attainment)) +
    geom_area(position = "identity", alpha = 0.7) +
    scale_fill_manual(values = c("high_school_or_higher" = "purple", "bachelors_or_higher" = "green"),
                      name = "Educational Attainment",
                      labels = c("high_school_or_higher" = "GED or higher", "bachelors_or_higher" = "Bachelor's or higher")) +
    labs(title = "Educational Attainment in Detroit",
         x = "\nYear",
         y = "% of Population\n",
         fill = "Educational Attainment") +
    theme_minimal()
```

# Education Outcomes Data (Opportunity Insights)

```{r read-in-data, include=FALSE}

#Opportunity Insights Data
cz_coll_allSubgroups <- read_csv("cz_coll_allSubgroups.csv") 

cz_frac_coll_plus2016 <- read_csv("cz_frac_coll_plus2016.csv") 

cz_hs_allSubgroups <- read_csv('cz_hs_allSubgroups.csv') 

#Gentrification Data
SanFran <- read_csv('SanFrancisco_typology_output.csv')


#DETROIT???
```

```{r combiningGradRates}
coll_gradRates <- cz_coll_allSubgroups |> 
  filter(name == 'Detroit, MI' | name == 'San Francisco, CA')

hs_gradRates <- cz_hs_allSubgroups |> 
  filter(name == 'Detroit, MI' | name == 'San Francisco, CA')

det_sf_gradRates <- inner_join(coll_gradRates, hs_gradRates, 
           by = c('cz', 'name'))

#Remove Late Cohorts
det_sf_gradRates <- det_sf_gradRates |> 
  select(-ends_with("_l"))

#Not Sure What We're Doing with this one?? 
fracColl <- cz_frac_coll_plus2016 |> 
  rename(name = Name) |> 
  filter(name == 'Detroit, MI' | name == 'San Francisco, CA')

```
