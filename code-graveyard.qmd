---
title: "423A Group Project code graveyard"
author: "Michael Chrzan"
format: html
editor: visual
---

```{r}
nces2017_growth |> 
  filter(district_code == '82015' & building_name == 'All Buildings' & testing_group == 'All Students') |> 
  select(grade, subject, testing_group, contains('percent')) |> 
  filter(!str_detect(subject, "Science"), 
         !str_detect(grade, "All Grades"))
#How do we want to handle reading& writing vs. English Language Arts in the above code?? !!!!!

#(includes science)
nces2017_growth |> 
  filter(district_code == '82015' & building_name == 'All Buildings' & testing_group == 'All Students') |> 
  mutate(year = 2017) |> 
  select(year, 
         grade, 
         subject, 
         testing_group, 
         contains('percent'), 
         -testing_group) |> 
  filter(!str_detect(grade, "All Grades"), 
         grade == '11')
```

```{r readiness}
nces2016_readiness <- nces2016_readiness |> 
  filter(district_code == '82015' & building_name == 'All Buildings' & subgroup == 'All Students') |> 
  mutate(year = 2016) |> 
  select(year, 
         math_percent_ready, 
         ebrw_percent_ready, 
         all_subject_percent_ready)

nces2017_readiness <- nces2017_readiness |> 
  filter(district_code == '82015' & building_name == 'All Buildings' & subgroup == 'All Students') |> 
  mutate(year = 2017) |> 
  select(year, 
         math_percent_ready, 
         ebrw_percent_ready, 
         all_subject_percent_ready)

nces2018_readiness <- nces2018_readiness |> 
  filter(district_code == '82015' & building_name == 'All Buildings' & subgroup == 'All Students') |> 
  mutate(year = 2018) |> 
  select(year, 
         math_percent_ready, 
         ebrw_percent_ready, 
         all_subject_percent_ready)

nces2019_readiness <- nces2019_readiness |> 
  filter(district_code == '82015' & building_name == 'All Buildings' & subgroup == 'All Students') |> 
  mutate(year = 2019) |> 
  select(year, 
         math_percent_ready, 
         ebrw_percent_ready, 
         all_subject_percent_ready)

nces_16_19_readiness <- bind_rows(nces2016_readiness, 
                                  nces2017_readiness, 
                                  nces2018_readiness, 
                                  nces2019_readiness)

nces_16_19_readiness
```

```{r}
#Getting Growth Data
nces2017_growth <- read_csv('NCES Data/Growth/(2016-2017) Student Growth.csv') |> clean_names()
nces2018_growth <- read_csv('NCES Data/Growth/(2017-2018) Student Growth (2017-18).csv') |> clean_names()
nces2019_growth <- read_csv('NCES Data/Growth/(2018-2019) Student Growth.csv') |> clean_names()

#Trying to Align with Growth Data
nces_allYears |> 
  pivot_longer(cols = ends_with('tested'), 
               names_to = 'grade_sub_tested',
               values_to = 'num_tested') |> 
  pivot_longer(cols = ends_with('proficient'), 
               names_to = 'grade_proficient', 
               values_to = 'num_proficient') |> 
  mutate(grade_sub_tested = str_replace(grade_sub_tested, "_tested$", ""),
         grade_proficient = str_replace(grade_proficient, "_proficient$", "")) |> 
  filter(grade_sub_tested == grade_proficient) |> 
  mutate(percent_proficient = 100*as.numeric(num_proficient)/as.numeric(num_tested)) |> 
  select(year, 
         contains('enrollment'), 
         graduation_rate_4_year, 
         dropout_rate_4_year, 
         grade_sub_tested, 
         num_tested, 
         num_proficient, 
         percent_proficient, 
         -grade_proficient) |> 
  filter(!str_detect(grade_sub_tested, "social_studies"),
         !str_detect(grade_sub_tested, "science"),
         !str_detect(grade_sub_tested, "grade_3"))
```

```{r}
#Old code for cleaning readiness tibbles
# nces2016_readiness <- nces2016_readiness |> 
#   filter(district_code == '82015' & building_name == 'All Buildings' & subgroup == 'All Students') |> 
#   mutate(year = 2016) |> 
#   select(year, 
#          math_percent_ready, 
#          ebrw_percent_ready, 
#          all_subject_percent_ready)
# 
# nces2017_readiness <- nces2017_readiness |> 
#   filter(district_code == '82015' & building_name == 'All Buildings' & subgroup == 'All Students') |> 
#   mutate(year = 2017) |> 
#   select(year, 
#          math_percent_ready, 
#          ebrw_percent_ready, 
#          all_subject_percent_ready)
# 
# nces2018_readiness <- nces2018_readiness |> 
#   filter(district_code == '82015' & building_name == 'All Buildings' & subgroup == 'All Students') |> 
#   mutate(year = 2018) |> 
#   select(year, 
#          math_percent_ready, 
#          ebrw_percent_ready, 
#          all_subject_percent_ready)
# 
# nces2019_readiness <- nces2019_readiness |> 
#   filter(district_code == '82015' & building_name == 'All Buildings' & subgroup == 'All Students') |> 
#   mutate(year = 2019) |> 
#   select(year, 
#          math_percent_ready, 
#          ebrw_percent_ready, 
#          all_subject_percent_ready)


```

```{r old-housing-value-viz}
all_data_gentrify |> 
  pivot_longer(cols = c(value_less_than_50_000, value_50_000_to_99_999, value_100_000_to_149_999, value_150_000_to_199_999, value_200_000_to_299_999, value_300_000_to_499_999, value_500_000_to_999_999, value_1_000_000_or_more),
               names_to = 'value_category', 
               values_to = 'number_of_properties') |> 
  select(year, value_median_dollars, value_category, number_of_properties) |> 
  mutate(year = as.character(year), 
         value_category = case_when(
           value_category == 'value_less_than_50_000' ~ 'Less than $50k',
           value_category == 'value_50_000_to_99_999' ~ '$50k - $99k', 
           value_category == 'value_100_000_to_149_999' ~ '$100k - $149k', 
           value_category == 'value_150_000_to_199_999' ~ '$150k - $199k', 
           value_category == 'value_200_000_to_299_999' ~ '$200k - $299k',
           value_category == 'value_300_000_to_499_999' ~ '$300k - $499k', 
           value_category == 'value_500_000_to_999_999' ~ '$500k - $999k', 
           value_category == 'value_1_000_000_or_more' ~ '$1000000+')) |> 
  
  ggplot() + 
  geom_col(aes(x = factor(value_category, 
                          levels = c('Less than $50k',
                                     '$50k - $99k', 
                                     '$100k - $149k', 
                                     '$150k - $199k', 
                                     '$200k - $299k',
                                     '$300k - $499k', 
                                     '$500k - $999k', 
                                     '$1000000+'), 
                          ordered = TRUE),
               y = number_of_properties), 
           position = 'dodge') + 
  facet_grid(~year) +
  labs(title = "Detroit's Housing Values are Increasing",
       subtitle = "Detroit Housing Values, 2010-2020", 
       x = 'Housing Value', 
       y = 'Number of Properties') + 
  coord_flip() +
  scale_fill_brewer(palette = 'Greens') +
  theme_minimal()
```
